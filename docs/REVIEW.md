# Code Review: Website Cloner

## Understanding from the Code　generated AI

### Overall System Architecture

This project is a system that takes a given website URL, completely clones that site with playwright, and deploys the cloned resource to a hosting service with vercel.

### Overall system flow
1. Enter URL → cli.ts receives command line arguments
2. Clone execution → cloner.ts duplicates the website
3. Deploy → deployer.ts uploads to Vercel
4. Display results → live URL is presented to user

### Clone system
**cloner.ts** executes the website cloning process

1. Create output directory
   - Create “cloned-site” folder by default
   - Can be changed by configuration

2. Start Playwright browser
   - Launch Chromium browser
   - Create a new page context

3. Access the specified URL
   - Access URL with `page.goto()`
   - `waitUntil: 'networkidle'` to wait for network activity to stop

4. Get HTML content from DOM after JavaScript execution
   - Get HTML after rendering with `page.content()`
   - SPAs can be cloned appropriately
   - Save as index.html

5. Resource discovery
   - Execute JavaScript in browser with `page.evaluate()`
   - Resource URL extraction by parsing DOM
   - Detect CSS (link[rel=“stylesheet”]), JS (script[src]), images (img[src])

6. Download individual resources
   - Download detected resources
   - Use browser context in `page.context().request.get()`
   - Extract file name from URL and save locally

7. Close browser and return results
   - Return results including statistics (number of files, total size, etc.)

### Deployment Service
**deployer.ts** executes the process flow to deploy the cloned site to Vercel

1. unique project name generation
   - Combine timestamp and random value
   - cloned-{timestamp}-{random}" format

2. Execute Vercel CLI commands
   - npx vercel --prod --yes --name {projectName} {localPath}
   - Deploy directly to production environment

3. Deploy URL extraction
   - Extract URL from console output using regular expression

4. Result Return
   - Return success/failure status and deploy URL

### CLI
**cli.ts** performs system-wide orchestration

1. Get command line arguments
   - Get URL from `process.argv[2]`
   - Exit with an error if URL is not specified

2. Create and execute WebsiteCloner instance
   - Clone process is executed by `cloner.clone()`
   - Store the result in cloneResult

3. Verify the clone result
   - If successful, go to the next step.
   - If failed, display error message and exit

4. Create and execute VercelDeployer instance
   - Deployment process is executed by `deployer.deploy()`
   - Pass the local path as an argument

5. Display the final result
   - On success: Display live URL
   - On failure: Error messages are displayed

### Technical Implementation Features

The use of Playwright enables this system to effectively handle not only static sites but also dynamic sites. By specifying networkidle with the waitUntil option, it waits until network activity becomes quiet, ensuring reliable acquisition of content dynamically generated by JavaScript.

The file saving mechanism extracts filenames from URLs and saves them to the local file system. The output directory is configurable, with "cloned-site" folder used by default.

### Architectural Design Philosophy

The entire system is designed based on the single responsibility principle. Each class has clearly separated responsibilities: WebsiteCloner for cloning, VercelDeployer for deployment, and CLI for overall coordination.

Error handling is implemented in stages, allowing individual processing of failures at each stage. However, the current implementation is designed so that if one stage fails, the entire process stops.

## Problems

### Incomplete Resource Detection

The current code only detects basic HTML tags:
- link[rel="stylesheet"] (CSS)
- script[src] (JavaScript)
- img[src] (Images)

Important resources not being detected:
- url() references inside CSS (e.g., background images, font files)
- Dynamically loaded resources via JavaScript
- <link rel="icon"> (favicon)
- <img srcset> and <picture> elements
- CSS @import statements
- Web font declarations with @font-face

### Relative Path Issues
- All downloaded resources are currently stored in the same directory
- Relative path references in the HTML are broken
- Original directory structure is not preserved

### File Name Collisions
```
const filename = path.basename(urlObj.pathname) || 'resource';
```
- Resources with the same file name overwrite each other
- URL parameters are ignored (e.g., ?v=1)

4. Missing Base URL Handling
- The <base href=""> tag is not added to the HTML
- Relative URLs are not resolved correctly without it